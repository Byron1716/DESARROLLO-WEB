{% extends "base.html" %}
{% block title %}Solicitar turno · Clínica SaluVida{% endblock %}

{% block content %}
<div class="row g-4">
  <div class="col-lg-8">
    <h2 class="mb-1">Hola paciente</h2>
    <p class="text-body-secondary mb-4">Completa el formulario para solicitar tu turno.</p>

    <form id="form-turno" method="post" action="{{ url_for('turno_guardar') }}" novalidate>
      <div class="row g-3">
        <div class="col-sm-6">
          <label for="nombre" class="form-label">Nombre</label>
          <input type="text" class="form-control" id="nombre" name="nombre"
                 placeholder="Juan Pérez"
                 value="{% if form_data %}{{ form_data.nombre }}{% elif turno_actual %}{{ turno_actual.paciente }}{% elif nombre %}{{ nombre }}{% endif %}">
        </div>

        <div class="col-sm-6">
          <label for="especialidad" class="form-label">Especialidad</label>
          {% set esp = (form_data.especialidad if form_data else (turno_actual.especialidad if turno_actual else '')) %}
          <select class="form-select" id="especialidad" name="especialidad">
            <option value="">Seleccione…</option>
            <option value="Pediatría" {{ 'selected' if esp=='Pediatría' else '' }}>Pediatría</option>
            <option value="Medicina General" {{ 'selected' if esp=='Medicina General' else '' }}>Medicina General</option>
            <option value="Dermatología" {{ 'selected' if esp=='Dermatología' else '' }}>Dermatología</option>
            <option value="Odontología" {{ 'selected' if esp=='Odontología' else '' }}>Odontología</option>
            <option value="Cardiología" {{ 'selected' if esp=='Cardiología' else '' }}>Cardiología</option>
          </select>
        </div>

        <div class="col-sm-6">
          <label for="fecha" class="form-label">Fecha</label>
          <input type="date" class="form-control" id="fecha" name="fecha"
                 value="{% if form_data %}{{ form_data.fecha }}{% elif turno_actual %}{{ turno_actual.fecha }}{% endif %}">
        </div>

        <div class="col-sm-6">
          <label for="hora" class="form-label">Hora</label>
          <input type="time" class="form-control" id="hora" name="hora"
                 value="{% if form_data %}{{ form_data.hora }}{% elif turno_actual %}{{ turno_actual.hora }}{% endif %}">
        </div>

        <div class="col-12">
          <label for="notas" class="form-label">Notas</label>
          <textarea class="form-control" id="notas" name="notas" rows="4"
                    placeholder="Síntomas, preferencia de médico, etc.">{% if form_data %}{{ form_data.notas }}{% elif turno_actual %}{{ turno_actual.notas }}{% endif %}</textarea>
        </div>
      </div>

      <div class="d-flex gap-2 mt-4">
        <button type="submit" class="btn btn-primary">Solicitar turno</button>
        <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">Volver</a>
      </div>
    </form>
  </div>

  <div class="col-lg-4">
    <div class="card border-0 shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Resumen</h5>
        {% set t = turno_actual %}
        <ul class="list-unstyled mb-0" id="resumen-lista">
          <li><strong>Paciente:</strong> <span id="r_paciente">{{ t.paciente if t else '—' }}</span></li>
          <li><strong>Clínica:</strong> <span id="r_clinica">{{ t.clinica if t else 'SaluVida' }}</span></li>
          <li><strong>Especialidad:</strong> <span id="r_especialidad">{{ t.especialidad if t else '—' }}</span></li>
          <li><strong>Fecha:</strong> <span id="r_fecha">{{ t.fecha if t else '—' }}</span></li>
          <li><strong>Hora:</strong> <span id="r_hora">{{ t.hora if t else '—' }}</span></li>
          <li class="mt-2">
            <strong>Estado:</strong>
            <span class="badge bg-success" id="r_estado">{{ t.estado if t else 'Disponible' }}</span>
          </li>
          <li class="mt-2">
            <strong>Notas:</strong>
            <div id="r_notas" class="text-body-secondary">{{ t.notas if t else '—' }}</div>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // Reflejo en vivo del resumen (opcional)
  (function () {
    const $ = s => document.querySelector(s);
    const set = (s, v, dash='—') => { const el = $(s); if (el) el.textContent = (v && v.trim()) ? v : dash; };

    const nombre = $('#nombre');
    const especialidad = $('#especialidad');
    const fecha = $('#fecha');
    const hora = $('#hora');
    const notas = $('#notas');

    if (nombre) nombre.addEventListener('input', () => set('#r_paciente', nombre.value));
    if (especialidad) especialidad.addEventListener('change', () => set('#r_especialidad', especialidad.value));
    if (fecha) fecha.addEventListener('change', () => set('#r_fecha', fecha.value));
    if (hora) hora.addEventListener('change', () => set('#r_hora', hora.value));
    if (notas) notas.addEventListener('input', () => set('#r_notas', notas.value));
  })();
</script>
{% endblock %}